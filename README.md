# 这是什么？
### 这是一个FM随机音乐播放器
- 预览如下：预览效果一致，可能存在加载速度和git pages解析速度的问题：首先无样式内容展示，其次重新渲染排版布局，最后加载完成自动播放
	1. [预览1：版本v3.2.0](http://htmlpreview.github.io/?https://github.com/NathanYangcn/fm-music-player/blob/master/index.html)
	2. [预览2：版本v2.2.0](http://htmlpreview.github.io/?https://github.com/NathanYangcn/fm-music-player/blob/master/history-version/v2.0.0/index.html)
	3. [历史版本进化过程预览](https://github.com/NathanYangcn/fm-music-player/tree/master/history-version)

# 实现了哪些功能？
1. 播放
2. 暂停
3. 切换曲目（因为随机性，所以只有切换下一首）
4. 频道切换
	- 切换频道后自动获取歌曲并自动播放
	- 默认频道：漫步春天
5. 音量调控(click)
	- 点击喇叭按钮，快速静音与开启声音，同时改变喇叭显示图标
	- 点击音量进度条调控音量大小，且进度条显示当前音量
6. 歌曲进程调控(click)
	- 显示当前进度
	- 显示音频已播放时间、音频总时间
	- 点击进度条调控歌曲播放进度，且进度条显示歌曲当前播放进度
	- 点击进度条，同时展示与歌曲进度匹配的歌词信息
7. 歌词展示
	- 以左右切换方式展示歌曲基础信息与歌曲歌词信息
	- 以上下滚动方式随歌曲进度自动展示对应歌词信息
	- 当前歌词信息以红色显示，并且字号变大
8. 隐藏控制面板
	- 原本UI未带，在原UI基础上添加额外功能，不要说丑(我不是设计 -。-)
	- 点击切换展示、隐藏
	- 包含控制项：音量调控进度条和按钮、频道按钮
9. 主体放大缩小
10. 快捷图标拖动

# 使用了哪些技术？
1. 原生JS
2. Web audio API
3. jsonp
4. jQuery
5. 面向对象
6. 组件化：拆分功能单独编写成模块
7. less
8. webpack
9. npm script

# 实现过程？
1. 了解学习Web audio API
2. 使用jQuery实现基本功能包括：暂停、播放、切换、音量控制、进程控制 —— 文件内添加音频source
3. 使用原生JS实现一个极简播放器，并扩展功能：使用音乐API与后端交互获取歌曲、频道资源，并实现频道切换
4. 使用jQuery改写所有功能
5. 拓展歌词功能：随音频进程的改变，滚动展示对应歌词
6. UI替换-HTML、CSS的建立
7. 使用面向对象写法修改JS文件
8. 使用less修改css文件
9. 使用webpack对文件进行编译、打包
10. 使用npm script使操作执行更为方便
11. 简单整理目录结构，将开发文件(src)与线上文件(public)分别存放，使文件结构清晰

# 遇到了哪些问题？
#### 1. 循环播放的问题
- 属性 loop 只是单曲循环播放，如果需要切换音频，需要监听 ended 事件，触发该事件时重新设置音频资源即可
- 属性 autoplay 是设置自动播放状态的，当进入或者切换音频资源时自动播放
#### 2. [我的文章总结：跨域获取资源](http://www.jianshu.com/p/0446b5bcdbab)
	- 使用语法不同(原生JS?jQuery?)，写法也不同，但原理一致
	- 跨域可选择的方法也不少，看看后台支持哪个，哪个更合适一些
	- jsonp和cors比较大众，但cors存在兼容问题，关于具体如何实现，我可是写了文章的哦
#### 3. 实现歌词滚动展示思路：
- 首先：和后台数据交互拿到歌词资源
- 其次：初始化资源，将歌词按格式 ‘["歌词时间","歌词内容"]’ 提取出来
	1. 特定资源特定分析，这只是处理我拿到的歌词办法，思路基本一致
	2. 把每一句歌词全部分割开来
	3. 遍历分割开的歌词，分别拿到其中的‘歌词时间’以及‘歌词内容’
	4. 将‘歌词时间’转换为总秒数
	5. 将‘歌词时间总秒数’和对应的‘歌词内容纯文本’放入最终结果歌词数组中，并重新排序
- 第三：遍历最终结果歌词数组，拼接字符串放入页面中 —— 歌词展示完成
- 第四：遍历‘歌词时间总秒数’，当音频时间(currentTime)，大于某句歌词时间&&小于下句歌词时间时，此时计算该句歌词高度，并展示出来 —— 歌词滚动展示完成
	1. 也可以计算单行高度，但要保证所有歌词都是单行展示，且没有空字符串行，否则会出现歌词展示不正确的情况：随歌曲进度前进与之匹配的歌词逐渐看不到了，因为歌词高度没有设置好
#### 4. 面向对象写法
- 这是一个熟练问题，需要适应这个写法，多写就会熟悉，刚开始我也有无从入手的感觉，那就在练习中照猫画虎找找套路
- 套路：使用原型或立即执行函数都可以，按照写法格式改写即可，最后注意修改内部this的指代，这其实就是在封装代码
- 既然面向过程时可以写出代码，那么在封装代码时就会更容易，因为这就是按照格式改写代码而已（自认为）
#### 5. webpack的配置以及使用
- 说好的博客还没写，后续会单独抽出一个目录，记录并整理我的webpack闯关过程
- 问题：引入jQuery后不起作用，报错信息为：$ 未定义
- 解决：配置全部完成且正确，当时花了很长时间排查这个错误，最后这个错误竟然是引入jQuery版本的问题，jQuery-1.9.1不支持，更换新版本后立刻生效，问题就这样被解决了
- 话外：jQuery-1.9.1 那个时代，webpack应该还没有出生，这个未查只是猜想
#### 6. less
- less允许使用嵌套语法，这样就缩短了书写css选择器的长度；
- 问题：less编译后，页面元素排版错乱
- 排查：less是需要编译的，编译后的文件中全部都是后代元素，没有直接子元素，所以问题在于less文件选择器书写错误
- 解决：使用直接子元素时需要符号：&，例：&>p(嵌套本层直接子元素p)；使用伪类元素时也需要符号：&，例：&:hover

# 已知未修复 bug
##### 1. 小图标触发的：鼠标click点击事件和拖拽事件 —— 可以试试状态锁进行修复
##### 2. 报错：Failed to load resource: net::ERR_CONNECTION_RESET —— 可能导致原因 git pages 支持协议有限，噗~

# 后续拓展方向
1. 列表播放功能
2. 播放历史记录
3. 适配移动端
4. 更多优化...

# 资料地址
1. [Web audio API](https://developer.mozilla.org/zh-CN/docs/Web/API/HTMLMediaElement)：API接口很多，挑出需要的
2. [webpack官网](https://doc.webpack-china.org/)：当配置完成真正跑通的时候就会感觉很容易
3. [less语法](http://www.bootcss.com/p/lesscss/)